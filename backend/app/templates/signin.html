{% extends "layout.html" %}
{% block content %}

<div class="wrapper">
    <div class="inner mt-5">
        <div class="image-holder">
            <img src="{{ url_for('static', filename='img/sign-up.jpg') }}" alt="">
        </div>
        <form method="POST" action="" novalidate>
            {{ form.hidden_tag() }}

            <h3>Welcome to SheWear</h3>
            <p class="fs-5 text-center">Please sign-in to your account to start Shopping</p>

           {% if blocked_until %}
<p id="block-message" class="text-center text-danger">
    Too many login attempts. Please try again in <span id="countdown"></span>.
</p>

<script>
    const blockedUntil = new Date("{{ blocked_until.isoformat() }}Z");
    const messageEl = document.getElementById("block-message");

    const timer = setInterval(() => {
        const now = new Date();
        const remaining = blockedUntil - now;

        if (remaining <= 0) {
            clearInterval(timer);
            // Replace entire content with new message and make it green
            messageEl.textContent = "You can try logging in again.";
            messageEl.classList.remove("text-danger");
            messageEl.classList.add("text-success");
        } else {
            const mins = Math.floor(remaining / 60000);
            const secs = Math.floor((remaining % 60000) / 1000);
            messageEl.innerHTML = `Too many login attempts. Please try again in <span id="countdown">${mins}m ${secs}s</span>.`;
        }
    }, 1000);
</script>
{% endif %}


            <div class="form-wrapper">

                {% if form.email.errors %}
                        {{ form.email(class="form-control form-control-lg is-invalid", placeholder="Email") }}
                        <div class="invalid-feedback">
                            {% for error in form.email.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.email(class="form-control form-control-lg mb-5", placeholder="Email") }}
                {% endif %}

                <!-- {{ form.email(class="form-control form-control-lg mb-5",placeholder="Email") }} -->
                <!-- <i class="bi bi-envelope-fill"></i> -->
            </div>



            <div class="form-wrapper mt-4 mb-5 password-login">


                <div class="input-group input-group-merge mb-4">
                    {% if form.password.errors %}
                        {{ form.password(class="form-control form-control-lg is-invalid", placeholder="Password") }}
                    {% else %}
                        {{ form.password(class="form-control form-control-lg", placeholder="Password") }}
                    {% endif %}
                    <span class="input-group-text cursor-pointer"><i class="bi bi-eye-slash fs-4"></i></span>
                    
                    {% if form.password.errors %}
                        <!-- Error feedback message positioned absolutely -->
                        <div class="invalid-feedback" style="position: absolute; bottom: -20px;">
                            {% for error in form.password.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

            </div>


            <div class="form-wrapper">
                <div class="form-check">
                    {{ form.remember(class="form-check-input") }}

                    {{ form.remember.label(class="form-check-label") }}
                </div>
     
            </div>
            
    

            <div class="text-center mt-4 register-btn">
                {{ form.submit(class="btn btn-primary") }}
            </div>


            <div class="d-flex justify-content-between pt-1 mt-1 mb-5">
                <small class="text-muted">
                    <a href="{{url_for('forgot_password')}}" class="ml-2">Forgot Password?</a>
                </small>
            
                <small class="text-muted">
                    <a href="{{url_for('register')}}" class="ml-2">Create Account</a>
                </small>
            </div>

            <div class="border-top pt-3 text-center mt-4">
      
                <small class="text-muted">
                    Join us <a href="{{url_for('register_seller')}}" class="ml-2">Register as Seller</a>
                </small>
            </div>

        </form>

        

    </div>

    
</div>

{% endblock %}