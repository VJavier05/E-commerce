{% extends "dashboard_2.html" %}
{% block content %}

<h4 class="fw-bold py-3 mb-2"><span class="text-muted fw-light">My Profiles /</span> Shop Info</h4>
<form id="formAccountSettings" action="" method="POST" enctype="multipart/form-data">
  {{ form.hidden_tag() }}
<div class="card mb-4">
    <h5 class="card-header">Shop Details</h5>
    
    <div class="card-body">
      <div class="d-flex align-items-start align-items-sm-center gap-4">
        <img
          src="{{image_file }}"  
          alt="user-avatar"
          class="d-block rounded"
          height="100"
          width="100"
          id="uploadedAvatar"
        />
            
        <div class="button-wrapper">
          <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
              <span class="d-none d-sm-block">Upload new photo</span>
              <i class="bx bx-upload d-block d-sm-none"></i>
              {{ form.image_file(class="account-file-input", id="upload", style="display:none;", accept="image/png, image/jpeg") }}
            </label>
          <p class="text-muted mb-0">Allowed JPG or PNG</p>
      </div>
      
      </div>
    </div>

    <hr class="my-0" />
    <div class="card-body">
    

        <div class="row">
            <div class="mb-3 col-md-6">
              <label for="shop_name" class="form-label">Shop Name</label>
              {{ form.shop_name(class="form-control", id="shop_name") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="category" class="form-label">Category</label>
              <div class="dropdown">
                  <!-- Custom Button to toggle dropdown -->
                  <button class="btn btn-primary dropdown-toggle form-control" type="button" id="categoryDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                      Select Categories
                  </button>
                  
                  <!-- Dropdown Menu with Checkboxes -->
                  <ul class="dropdown-menu w-100 p-2" aria-labelledby="categoryDropdown">
                      {% for value, label in form.category.choices %}
                      <li>
                          <div class="form-check">
                              <input 
                                  class="form-check-input" 
                                  type="checkbox" 
                                  name="category" 
                                  value="{{ value }}" 
                                  id="category_{{ value }}" 
                                  {% if value in form.category.data %}checked{% endif %}>
                              <label class="form-check-label" for="category_{{ value }}">{{ label }}</label>
                          </div>
                      </li>
                      {% endfor %}
                  </ul>
              </div>
              
              <!-- Hidden Input to store selected categories -->
              <input type="hidden" name="category_selected" id="category_selected" value="{{ ','.join(form.category.data) }}">
          </div>
            <div class="mb-3 col-md-6">
              <label for="street" class="form-label">Street</label>
              {{ form.street(class="form-control", id="street") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="barangay" class="form-label">Barangay</label>
              {{ form.barangay(class="form-control", id="barangay") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="city" class="form-label">City</label>
              {{ form.city(class="form-control", id="city") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="province" class="form-label">Province</label>
              {{ form.province(class="form-control", id="province") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="region" class="form-label">Region</label>
              {{ form.region(class="form-control", id="region") }}
            </div>
            <div class="mb-3 col-md-6">
              <label for="postal_code" class="form-label">Postal Code</label>
              {{ form.postal_code(class="form-control", id="postal_code") }}
            </div>
  
          </div>
          
          <div class="d-flex justify-content-end mt-2">
            {{ form.submit(class="btn btn-primary me-2") }}
          </div>
          
      </form>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const dropdownButton = document.getElementById('categoryDropdown');
        const checkboxes = document.querySelectorAll('input[name="category"]');
        const selectedCategoriesDisplay = document.getElementById('selectedCategories');
        const selectedCategoriesInput = document.getElementById('category_selected');

        // Update the dropdown button and display selected categories
        function updateSelectedCategories() {
            const selected = Array.from(checkboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.nextElementSibling.textContent.trim());

            if (selected.length > 0) {
                dropdownButton.textContent = selected.join(', ');
                selectedCategoriesDisplay.textContent = selected.join(', ');
                selectedCategoriesInput.value = selected.join(',');  // Update hidden input with selected values
            } else {
                dropdownButton.textContent = 'Select Categories';
                selectedCategoriesDisplay.textContent = 'None';
                selectedCategoriesInput.value = '';  // Clear hidden input if no categories selected
            }
        }

        // Add event listeners to checkboxes
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectedCategories);
        });

        // Initial update with current selections
        updateSelectedCategories();
    });
</script>


{% endblock %}
