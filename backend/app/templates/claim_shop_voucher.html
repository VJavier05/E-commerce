{% extends "account.html" %}
{% block dashboard_content %}


<div class="container shadow mt-5">
    <h2>My Vouchers</h2>
    <div class="container">
        <!-- Voucher Code Card Container in the Top Right -->
        <div class="voucher-code-card position-relative">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-6 text-primary">Claim Voucher By Code</h4>
                    <form action="{{ url_for('claim_voucher_by_code') }}" method="POST">
                        <div class="input-group mb-3">
                            <input 
                            type="text" 
                            name="voucher_code" 
                            class="form-control" 
                            placeholder="Enter voucher code" 
                            required
                            style="height: 40px; font-size: small;">
                            <button class="btn btn-primary" type="submit">Claim Voucher</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <hr class="new2">
        <h3 class="text-secondary"><i class="bi bi-cart4"></i> Shop Vouchers</h3>
        <div class="row g-4">
            {% for voucher in available_vouchers if voucher.voucher_type == "shop" %}
            <div class="col-md-6 col-lg-6">
                <div class="coupon card position-relative shadow-sm border-0 h-100">
                    <!-- Perforated Border -->
                    <div class="border-dashed rounded p-3 h-100">
                        {% if voucher.quantity == 0 %}
                            <div class="badge bg-danger position-absolute top-0 end-0 m-3 fs-5">Out of Stock</div>
                        {% elif voucher.expired %}
                            <div class="badge bg-secondary position-absolute top-0 end-0 m-3 fs-5">Expired</div>
                        {% elif voucher.archived %}
                            <div class="badge bg-dark position-absolute top-0 end-0 m-3 fs-5">Used</div>
                        {% elif voucher.claimed %}
                            <div class="badge bg-info position-absolute top-0 end-0 m-3 fs-5">Claimed</div>
                        {% endif %}
                        <div class="row g-3 align-items-center h-100">
                            <!-- Discount Section -->
                            <div class="col-4 text-center bg-gradient text-white p-4 rounded-start " 
                                style="background: linear-gradient(45deg, #4e73df, #1cc88a);">
                                
                                <h6 class="mb-1">Discount</h6>
                                <h3 class="fw-bold">
                                    {% if voucher.discount_type == 'percentage' %}
                                        {{ voucher.discount_amount|int }}%
                                    {% else %}
                                        ‚Ç±{{ voucher.discount_amount|int }}
                                    {% endif %}
                                </h3>
                            </div>
                            <!-- Details Section -->
                            <div class="col-8">
                                <h5 class="card-title text-primary mb-1"><i class="bi bi-shop-window"></i> {{ voucher.voucher_name }}</h5>
                                <p class="text-muted mb-2">
                                    Shop: <strong>{{ voucher.item_info.name }}</strong><br>
                                    Minimum Spend: <strong>‚Ç±{{ voucher.min_price }}</strong><br>
                                    Valid Until: <strong>{{ voucher.expiration_date.strftime('%Y-%m-%d') }}</strong>
                                </p>
                                <form action="{{ url_for('claim_voucher', voucher_id=voucher.id) }}" method="POST" class="mt-3">
                                    <button class="btn btn-primary w-100"
                                        {% if voucher.claimed or voucher.expired or voucher.archived or voucher.quantity == 0 %}disabled{% endif %}>
                                        Claim Voucher
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- PRODUCT VOUCHER -->
        <hr class="new2">
        <h3 class="mt-5 text-secondary">üõç Product Vouchers</h3>
    <div class="row g-4">
        {% for voucher in available_vouchers if voucher.voucher_type == "product" %}
        <div class="col-md-6 col-lg-6">
            <div class="coupon card position-relative shadow-sm border-0 h-100">
                <!-- Perforated Border -->
                <div class="border-dashed rounded p-3 h-100">
                    {% if voucher.quantity == 0 %}
                        <div class="badge bg-danger position-absolute top-0 end-0 m-3 fs-5">Out of Stock</div>
                    {% elif voucher.expired %}
                        <div class="badge bg-secondary position-absolute top-0 end-0 m-3 fs-5">Expired</div>
                    {% elif voucher.archived %}
                        <div class="badge bg-dark position-absolute top-0 end-0 m-3 fs-5">Used</div>
                    {% elif voucher.claimed %}
                        <div class="badge bg-info position-absolute top-0 end-0 m-3 fs-5">Claimed</div>
                    {% endif %}
                    <div class="row g-3 align-items-center h-100">
                        <!-- Discount Section -->
                        <div class="col-4 text-center bg-gradient text-white p-4 rounded-start" 
                            style="background: linear-gradient(45deg, #fd7e14, #dc3545);">
                            <h6 class="mb-1">Discount</h6>
                            <h3 class="fw-bold">
                                {% if voucher.discount_type == 'percentage' %}
                                    {{ voucher.discount_amount|int }}%
                                {% else %}
                                    ‚Ç±{{ voucher.discount_amount|int }}
                                {% endif %}
                            </h3>
                        </div>
                        <!-- Details Section -->
                        <div class="col-8">
                            <h5 class="card-title text-primary mb-1"><i class="bi bi-tags"></i> {{ voucher.voucher_name }}</h5>
                            <p class="text-muted mb-2">
                                Product:<strong> {{ voucher.item_info.name }}</strong><br>
                                Minimum Spend: <strong>‚Ç±{{ voucher.min_price }}</strong><br>
                                Valid Until: <strong>{{ voucher.expiration_date.strftime('%Y-%m-%d') }}</strong>
                            </p>
                            <form action="{{ url_for('claim_voucher', voucher_id=voucher.id) }}" method="POST" class="mt-3">
                                <button class="btn btn-primary w-100"
                                    {% if voucher.claimed or voucher.expired or voucher.archived or voucher.quantity == 0 %}disabled{% endif %}>
                                    Claim Voucher
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

        <!-- {% if not available_vouchers %}
        <div class="alert alert-info" role="alert">
            No vouchers available at this time.
        </div>
        {% endif %} -->
    </div>
</div>

<style>
        /* Position the Voucher Code Card */
    hr.new2 {   
        border-top: 3px dashed rgb(0, 0, 0);
    }

    .voucher-code-card {
        position: relative;
        top: 10%;
        width: 100%;
        margin-bottom: 20px;

    }
    /*.voucher-code-card:hover{
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);

    }*/
    .ticket-card {
        border: 2px solid #696cff; /* Solid border */
        border-radius: 15px; /* Rounded corners */
        padding: 0; /* Remove default padding for flexbox */
        background: #f8f9fa; /* Light background color */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
        transition: transform 0.2s; /* Animation on hover */
        height: 200px;
        width: 100%;
        display: flex; 
        flex-direction: row;
        justify-content: space-between; /* Evenly space elements */
        margin-bottom: 20px;

    }
    /* OLD DESIGN */
    /* .ticket-card {
        border: 2px solid #17a2b8;
        border-radius: 15px;
        padding: 0; 
        background: #f8f9fa;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
    } */

    .ticket-card:hover {
        transform: translateY(-5px); /* Lift effect on hover */
    }
    .status-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: rotate(-15deg);
        z-index: 10;
        color: white; /* Overlay text color */
    }
    .status-overlay span {
        font-size: 1.5em;
        font-weight: bold;
        text-transform: uppercase;
    }
    /* Update status overlay styles */
    .status-overlay.expired {
        color: rgba(109, 99, 100, 0.7); /* Gray for out of stock */
    }
    .status-overlay.quantity {
        color: rgba(220, 53, 69, 0.7); /* Red for expired */
    }
    .status-overlay.claimed {
        color: rgba(7, 94, 255, 0.7); /* Blue for claimed */
    }
    .status-overlay.archived {
        color: rgba(238, 255, 0, 0.7); /* Blue for claimed */
    }
    /* Button hover effect */
    .btn-primary:hover {
        background-color: #696cff; /* Darken button on hover */
        border-color: #696cff; /* Darken border on hover */
    }


    .coupon .border-dashed {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        position: relative;
    }
    
    .coupon .border-dashed::before, 
    .coupon .border-dashed::after {
        content: '';
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 10px;
        height: 10px;
        background: white;
        border: 2px solid #ccc;
        border-radius: 50%;
        z-index: 1;
    }
    
    .coupon .border-dashed::before {
        left: -15px;
    }
    
    .coupon .border-dashed::after {
        right: -15px;
    }
    
</style>
{% endblock %}
